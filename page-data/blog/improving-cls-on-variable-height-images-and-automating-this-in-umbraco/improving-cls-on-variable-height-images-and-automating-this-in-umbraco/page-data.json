{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/improving-cls-on-variable-height-images-and-automating-this-in-umbraco/improving-cls-on-variable-height-images-and-automating-this-in-umbraco/","result":{"data":{"site":{"siteMetadata":{"title":"Chester Loffman"}},"markdownRemark":{"id":"52afd5a7-c818-5703-9a22-af8396507c03","excerpt":"CLS stands for cumulative layout shift, in short this is caused when a element is added or loaded and forces other visible elements on the page to shift. You…","html":"<h2>What is CLS?</h2>\n<p>CLS stands for cumulative layout shift, in short this is caused when a element is added or loaded and forces other visible elements on the page to shift. You may have noticed this when browsing web pages that use image lazy loading, as you scroll down images will load in as you need them, however these unloaded images do not take up any space on the page so when they load it causes other elements on the page to shift around. This leads to a poor user experience as the user may be moved around the page unexpectedly, additionally this is a key metric in google page speed scores.</p>\n<h2>Preventing CLS on variable height images</h2>\n<p>There are many common techniques for solving this such as the <a href=\"https://css-tricks.com/snippets/sass/maintain-aspect-ratio-mixin/\">aspect ratio</a> trick that locks an image to a fixed aspect ratio using a combination of pseudo elements and object fit properties (there is a native property coming soon called <code class=\"language-text\">aspect-ratio</code>). However, how is it best to handle a component that will accommodate images of different heights?</p>\n<p>Take this component for example:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/046894b7cbcae70f7948702879cdf73a/d0fa6/cls-component.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbElEQVQoz4WRb0gTYRzH73WvixJSyCwSsYIC35giLYv5hzJtLUxzlKKsmrM2dKaWiWAuiEREo14UhVAm23O7O89hTufM3e7v87jb9O52U6fkq170Plz4Jlh9Xn1/Lz5vfh+MZuI+RiNZjYioZESlucQ3QZ/jtTlBDwoKlEQpM9gMqwF2k+A2KX5jMbq7LP8IouT31dRyNMWgxH/koKjOi8mV6A69vDT07lnviG143JFIbqmJLTmmSOI/5QhUBFlfV1Put64Ge5nlgcHmrFyY/7q9kdA1RZQkmEbaHxBKf849Ga3GlLgKIeMet/UMNk6MPn3/pm/q4+COFtnWoyzL8RzPcRzP8xzHsiybHpwgCHuyjFBKVaamR+7Zi69bznX2mD2fBnR2+pce2JKXfASJ+3AAAI4DX3oAADxeTyAQgBBiSBBVCONcaGZ6bPLD0PP+O5MTju3Il5+ITopBetZPkgRJUQRJ+v1+kiAAABRFLYVCCCFMkmJIlNcktKslQ8QUCtAc/XljwbcL+TWexwnC6/XgPtzr9QIASJKcpWcpilpYXIQIYX1uu6m15JbV0N7V5HA1jY26JsafvHK3O7trht12QZDC4RWGYcJMmIkwYvr54n4CzGxrzC7OOl1bkFeRf7nN0Np70/TQWFJ/vqz5RMdQ7VpclSQRQojS/J3K7LTkVxfmNxaeqj+bayrMM58paCm65CwvdRraRq2xVVnInBqrfnz7QHnOEVNedkNuTvOxo80nsyzHD1pzDt89dKO/cj2mCKKQUX70uqvofvkF19XSbmNFr7FuoK5q4Mq1F1U1HRc7X1pjclzMLP8Gx0Ec8dAyVYYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CLS example\"\n        title=\"CLS example\"\n        src=\"/blog/static/046894b7cbcae70f7948702879cdf73a/f058b/cls-component.png\"\n        srcset=\"/blog/static/046894b7cbcae70f7948702879cdf73a/c26ae/cls-component.png 158w,\n/blog/static/046894b7cbcae70f7948702879cdf73a/6bdcf/cls-component.png 315w,\n/blog/static/046894b7cbcae70f7948702879cdf73a/f058b/cls-component.png 630w,\n/blog/static/046894b7cbcae70f7948702879cdf73a/40601/cls-component.png 945w,\n/blog/static/046894b7cbcae70f7948702879cdf73a/78612/cls-component.png 1260w,\n/blog/static/046894b7cbcae70f7948702879cdf73a/d0fa6/cls-component.png 1263w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The image on the left will have a fixed width, however depending on what image is used it may have a different height (the component can accommodate both landscape and portrait images). I’ve set a width of 100% for the image as it will always fit to the left hand column width wise, and set the height to auto, this results in the image always proportionally (re)sizing to the container it’s placed in.</p>\n<p>However, in our example the content is smaller in height than the image, therefore before the image has loaded it looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6542a72742a8320a98ad0a2d9f39c070/29114/cls-unloaded-image-no-att.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAg0lEQVQY04WPSw7DIBBDc//LRDAMjEesgWwovwNVatruknhlWXqy3jav03svpeScj+M4S0rpv4wxtityrfWqFRBARUQVCkAhEkQkxthae4CJnDXWGmuMYc9Edt93IoLqnPMOrrUys2P2ITjnmNl7BhBCUNW7569zLuVjear21uZa45c3Advr9odHfmEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CLS example\"\n        title=\"CLS example\"\n        src=\"/blog/static/6542a72742a8320a98ad0a2d9f39c070/f058b/cls-unloaded-image-no-att.png\"\n        srcset=\"/blog/static/6542a72742a8320a98ad0a2d9f39c070/c26ae/cls-unloaded-image-no-att.png 158w,\n/blog/static/6542a72742a8320a98ad0a2d9f39c070/6bdcf/cls-unloaded-image-no-att.png 315w,\n/blog/static/6542a72742a8320a98ad0a2d9f39c070/f058b/cls-unloaded-image-no-att.png 630w,\n/blog/static/6542a72742a8320a98ad0a2d9f39c070/40601/cls-unloaded-image-no-att.png 945w,\n/blog/static/6542a72742a8320a98ad0a2d9f39c070/78612/cls-unloaded-image-no-att.png 1260w,\n/blog/static/6542a72742a8320a98ad0a2d9f39c070/29114/cls-unloaded-image-no-att.png 1920w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The components overall height without the image loaded is much shorter, therefore when the image is loaded (either on page load or via lazy loading) it will cause not only for the component to change in height but other elements on the page to move about. How do we prevent this issue? The simple solution to this is to add width and height attributes on the image tag and set the corresponding values to the dimensions of the image:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component__image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>600<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>800<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://images.pexels.com/photos/1067333/pexels-photo-1067333.jpeg?width=600<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>You may think this will cause sizing issues as we are setting a explicit width and height attribute (especially as we resize the screen to different breakpoints) however the browser will calculate the space needed after any CSS rules are applied e.g. <code class=\"language-text\">width: 100%; height: auto</code>. The result is that in the image in it’s unloaded state will now take up space:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c4764cf5cb706f447ecf4b99bda544a9/d0fa6/cls-unloaded-image-att.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqElEQVQoz8WSTQ6DIBBGvf9xHHC+Rtxo4kalTAfu0wCpOzFNF30JMPy8TGDoROR1jTbpRORq769y/KCqZ1in93II4ZkJJfDe+7pSrWs5xhACM1trTWEoARnqqZ/nOcbUyiwizjmAAYB5chODjTHAY13XlFpyzjzwQETW5p6IAIzjCGBZltiU8533zFbadhz7Wfo6tmRVTSnVJ06F70rVLvVvn6Rx4lZ+Awo9eTfxX+kFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CLS example\"\n        title=\"CLS example\"\n        src=\"/blog/static/c4764cf5cb706f447ecf4b99bda544a9/f058b/cls-unloaded-image-att.png\"\n        srcset=\"/blog/static/c4764cf5cb706f447ecf4b99bda544a9/c26ae/cls-unloaded-image-att.png 158w,\n/blog/static/c4764cf5cb706f447ecf4b99bda544a9/6bdcf/cls-unloaded-image-att.png 315w,\n/blog/static/c4764cf5cb706f447ecf4b99bda544a9/f058b/cls-unloaded-image-att.png 630w,\n/blog/static/c4764cf5cb706f447ecf4b99bda544a9/40601/cls-unloaded-image-att.png 945w,\n/blog/static/c4764cf5cb706f447ecf4b99bda544a9/78612/cls-unloaded-image-att.png 1260w,\n/blog/static/c4764cf5cb706f447ecf4b99bda544a9/d0fa6/cls-unloaded-image-att.png 1263w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see the outline of the visible space reserved for the image by the browser, you could even set a background colour/placeholder here to indicate to the user that this space will be filled.</p>\n<p>Link to codepen: <a href=\"https://codepen.io/cjloff/pen/qBqMawa?editors=1100\">https://codepen.io/cjloff/pen/qBqMawa?editors=1100</a></p>\n<h2>Automating in Umbraco</h2>\n<p>It is possible to automate this process in Umbraco with the following razor code:</p>\n<div class=\"gatsby-highlight\" data-language=\"razor\"><pre class=\"language-razor\"><code class=\"language-razor\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component__image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@Model.Image.GetPropertyValue(<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">umbracoWidth\")\"</span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@Model.Image.GetPropertyValue(<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">umbracoHeight\")\"</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@Model.Image.GetCropUrl(600)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This code is broken down as follows:</p>\n<ol>\n<li>Set the image width and height attributes to their original source dimensions of the image in the media library e.g. 1200 x 1800 using the <code class=\"language-text\">umbracoWidth</code> and <code class=\"language-text\">umbracoHeight</code> properties.</li>\n<li>As I’m using CSS to set the image width to 100% and height to auto the browser will effectively work out the space required for the image, even if the original source image dimensions exceeds the width of the container it’s placed in. For example, if the image (with original dimensions of 1200px x 1800px) is placed in a container that has a width of 600px, the browser will work out that the effective space that needs to be reserved is 600px x 900px.</li>\n<li>Use the <code class=\"language-text\">GetCropUrl</code> method (which utilizes <a href=\"https://imageprocessor.org/\">.NET ImageProcessor</a> under the hood) and only set the width property to 600px, this will automatically set the height of the returned image to 900px. This will ensure that we load in an image with the correct dimensions and appropriate weight.</li>\n</ol>\n<p>This is a simple technique that solves CLS issues on variable height images.</p>","frontmatter":{"title":"Preventing CLS on variable height images and automating this in Umbraco","date":"March 06, 2021","description":null}},"previous":{"fields":{"slug":"/blog/accessibility-tips/accessibility-tips/"},"frontmatter":{"title":"5 Accessibility Tips"}},"next":{"fields":{"slug":"/blog/transpiling-javascript-and-including-polyfills/transpiling-javascript-and-including-polyfills/"},"frontmatter":{"title":"Transpiling javascript and including polyfills with webpack, babel-preset-env and core-js"}}},"pageContext":{"id":"52afd5a7-c818-5703-9a22-af8396507c03","previousPostId":"c81359f7-db8c-5a4c-841f-921b63222550","nextPostId":"33f65990-e944-5afe-bc58-99684a4ac177"}},"staticQueryHashes":["2841359383"]}