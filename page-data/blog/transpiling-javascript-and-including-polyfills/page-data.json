{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/transpiling-javascript-and-including-polyfills/","result":{"data":{"site":{"siteMetadata":{"title":"Chester Loffman"}},"markdownRemark":{"id":"752b7eed-08df-54cb-85d9-f5c80cf73c16","excerpt":"I am going to use babel-preset-env to transpile our JS from ES6 to ES5 and core-js (a library of polyfills) to include the polyfills needed for your application…","html":"<p>I am going to use <a href=\"https://babeljs.io/docs/en/babel-preset-env\">babel-preset-env</a> to transpile our JS from ES6 to ES5 and core-js (a library of polyfills) to include the polyfills needed for your application.</p>\n<p>You may be used to including polyfills like so at the top of your entry file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"babel-polyfill\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will bring in a range of polyfills allowing you to use ES6 features and more in older browsers. However, the main issue is that this is a brute force approach and may bring in polyfills that are unneeded for your application and ultimately bloat your javascript bundle (the package itself has also been deprecated). Instead, in this tutorial we will utilize <a href=\"https://github.com/zloirock/core-js\">core-js</a> to bring in polyfills based on your browser support.</p>\n<h2>Some definitions...</h2>\n<p>Before we continue let’s clarify what we mean by polyfills and transpiling.</p>\n<p>Polyfills provide specific functionality that you would expect the browser (API) to natively have, for example <a href=\"https://caniuse.com/promises\">IE11 does not have promises</a> so you may include a polyfill that emulates this functionality.</p>\n<p>On the other hand, transpiling will transform your code to work in a particular target environment, for example if you wanted to use arrow functions (ES6 syntax) in your code but wanted to support IE11 you would need to transform it into ES5 compatible code that the browser understands.</p>\n<h2>Setup</h2>\n<p>Install the following packages into your application:</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">npm install --save-dev babel-loader @babel/core @babel/preset-env core-js\r\n</code></pre></div>\n<p>Let’s add a babel-loader rule within our webpack config, and add babel-preset-env to our presets:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n  rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.js$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\r\n      exclude<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\r\n      use<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        loader<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\r\n        options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n          presets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next up, let’s set which browsers we want to support in our package.json (babel-preset-env will use this to determine if it should transpile your code and which polyfills to add), you may already have this if you are using packages such as autoprefixer that also utilizes the <code class=\"language-text\">browserslist</code> property:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"browserslist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token string\">\"defaults\"</span>\r\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Be careful you only add browsers here which you need to support otherwise you may end up unnecessarily bloating your application’s JS bundle. For example, if you don’t want to support IE11, add “not IE 11”.</p>\n<p>With this setup your code will now be transpiled from ES6 to ES5 (dependent on your browserlist), next up let’s look at both options for including polyfills with core-js.</p>\n<h2>Option 1: Entry point</h2>\n<p>The first option is to to bring all the polyfills in at entry:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\r\n  loader<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\r\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      presets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      useBuiltIns<span class=\"token operator\">:</span> <span class=\"token string\">\"entry\"</span><span class=\"token punctuation\">,</span>\r\n      corejs<span class=\"token operator\">:</span> <span class=\"token number\">3</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We will also need to add the following at the JS entry point of our application:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"core-js/stable\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"regenerator-runtime/runtime\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will bring in polyfills according to your <code class=\"language-text\">browserslist</code> at the top of this file.</p>\n<h2>Option 2: Usage</h2>\n<p>We also have the option to bring the polyfills based on usage, meaning we do not bring in polyfills that are not needed by our application:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\r\n  loader<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\r\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      presets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      useBuiltIns<span class=\"token operator\">:</span> <span class=\"token string\">\"usage\"</span><span class=\"token punctuation\">,</span>\r\n      corejs<span class=\"token operator\">:</span> <span class=\"token number\">3</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We do not to add the imports at the entry file as babel-preset-env will include polyfills by scanning your JS files and determining which features need a polyfill (according to your <code class=\"language-text\">browserslist</code>).</p>\n<p>For example, if you have set your <code class=\"language-text\">browserslist</code> to support IE11 and you use <code class=\"language-text\">forEach</code> on a <code class=\"language-text\">nodeList</code> (which does not work in IE11) within your code <code class=\"language-text\">babel-preset-env</code> will add a polyfill to support this (this isn’t a ES6 feature but core-js also has a polyfill for this).</p>\n<p>Additionally, you can add <code class=\"language-text\">debug: true</code> to the options to see the JS files that have required  polyfills (this is displayed within the terminal).</p>\n<h2>Summing up</h2>\n<p>Within webpack’s babel-loader we have setup babel-preset-env to transpile code to ES5 and we have seen two different ways of including polyfills via core-js in your application. The main benefit of both is is that when you update your <code class=\"language-text\">browserslist</code> it will also update which code is transpiled and what polyfills are added (making it easier to drop support of older browsers, and reduce your JS bundle size as a result).</p>","frontmatter":{"title":"Transpiling javascript and including polyfills with webpack, babel-preset-env and core-js","date":"March 18, 2021","description":null}},"previous":{"fields":{"slug":"/blog/improving-cls-on-variable-height-images-and-automating-this-in-umbraco/"},"frontmatter":{"title":"Preventing CLS on variable height images and automating this in Umbraco"}},"next":{"fields":{"slug":"/blog/switching-from-bem-to-tailwind/"},"frontmatter":{"title":"Switching from BEM to Tailwind"}}},"pageContext":{"id":"752b7eed-08df-54cb-85d9-f5c80cf73c16","previousPostId":"c0bc5be9-a560-5940-b727-5a8f6e1076d3","nextPostId":"6b12dbf5-6977-5d8d-839e-c82063606ab0"}},"staticQueryHashes":["2841359383"]}